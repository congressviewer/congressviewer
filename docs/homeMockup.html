<!doctype html>
<html class="no-js" lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Congress Viewer</title>
  <link rel="stylesheet" href="css/app.css">
  <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation.css">-->
  <link href="https://use.fontawesome.com/releases/v5.0.7/css/all.css" rel="stylesheet">

  <link rel="icon" type="image/png" href="img/favicon.png">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114562198-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-114562198-1');
  </script>

</head>
<body>

<div class="cvSidebar">
  <h1 class="cvSidebar_siteLogo">Congress<br class="hide-for-small-only"> <i class="fas fa-eye"></i>Viewer</h1>
  <hr class="cvSidebar_divider hide-for-small-only">
  <ul class="cvSidebar_nav hide-for-small-only">
    <li><a href="#" class="cvSidebar_navItem"><i class="fas fa-check"></i>Recent Votes</a></li>
    <li><a href="#" class="cvSidebar_navItem"><i class="far fa-calendar-alt"></i>Upcoming Bills</a></li>
    <li><a href="#" class="cvSidebar_navItem"><i class="fas fa-user-circle"></i>Representitive Info</a></li>
  </ul>
  <hr class="cvSidebar_divider hide-for-small-only">
  <ul class="cvSidebar_siteLinks hide-for-small-only">
    <li><a href="#" class="cvSidebar_siteLinksItem">About</a></li>
    <li><a href="#" class="cvSidebar_siteLinksItem">Contact</a></li>
  </ul>
</div>
<div class="cvContent">
  <div class="cvTabs">

    <ul class="tabs" data-tabs id="example-tabs">
      <li class="tabs-title"><a data-tabs-target="panel2" href="#panel2">House</a></li>
      <li class="tabs-title is-active"><a href="#panel1" aria-selected="true">Senate</a></li>
    </ul>
    <div class="tabs-content" data-tabs-content="example-tabs">
      <div class="tabs-panel is-active" id="panel1">
        <h4 class="light-text">senate content</h4>



      </div>
      <div class="tabs-panel" id="panel2">

        <div class="cvMainGrid grid-x grid-padding-x">
          <div class="cell large-8">

            <h2>Recent Votes</h2>

            <div class="cvContent_panel">
              <!--date--><h6 class="light-text float-right">2017-07-28</h6>
              <!--question--><h6 class="light-text">On Passage</h6>
              <!--description--><h4><a href="" style="color:white;text-decoration:underline;">Department of Veterans Affairs Bonus Transparency Act</a></h4>
              <!--number-title--><p>S.114 - To authorize appropriations and to appropriate amounts for the Veterans Choice Program of the Department of Veterans Affairs, to improve hiring authorities of the Department, to authorize major medical facility leases, and for other purposes.</p>
              <!--latest action--><p><strong>Became Public Law No: 115-46</strong></p>
              <hr>

              <div class="grid-x grid-padding-x">
                <div class="cell small-3">
                  <h4><small>Result:</small> <span class="passed">Passed</span></h4>
                </div>
                <div class="cell small-3">
                  <h4><small>Yes</small></h4>
                  <span class="label democrat">186</span>
                  <span class="label republican">228</span>
                </div>
                <div class="cell small-3">
                  <h4><small>No</small></h4>
                  <span class="label democrat">0</span>
                  <span class="label republican">0</span>
                </div>
                <div class="cell small-3">
                  <h4><small>Not Voting</small></h4>
                  <span class="label democrat">8</span>
                  <span class="label republican">12</span>
                </div>
              </div>
            </div>

            <div class="cvContent_panel">
              <!--date--><h6 class="light-text float-right">2017-07-27</h6>
              <!--question--><h6 class="light-text">On Agreeing to the Amendment</h6>
              <!--description--><h4><a href="" style="color:white;text-decoration:underline;">Nadler of New York Part B Amendment No. 38</a></h4>
              <!--number-title--><p>H.R.3219 - Make America Secure Appropriations Act, 2018</p>
              <!--latest action--><p><strong>Read the second time. Placed on Senate Legislative Calendar under General Orders. Calendar No. 187.</strong></p>
              <hr>

              <div class="grid-x grid-padding-x">
                <div class="cell small-3">
                  <h4><small>Result:</small> <span class="failed">Failed</span></h4>
                </div>
                <div class="cell small-3">
                  <h4><small>Yes</small></h4>
                  <span class="label democrat">169</span>
                  <span class="label republican">3</span>
                </div>
                <div class="cell small-3">
                  <h4><small>No</small></h4>
                  <span class="label democrat">22</span>
                  <span class="label republican">230</span>
                </div>
                <div class="cell small-3">
                  <h4><small>Not Voting</small></h4>
                  <span class="label democrat">3</span>
                  <span class="label republican">7</span>
                </div>
              </div>
            </div>

          </div><!--.cell-->
          <div class="cell large-4 js-homeUpcoming">

            <h2>Upcoming Bills</h2>

          </div><!--.cell-->
        </div><!--.cvMainGrid grid-x-->

      </div>
    </div>

  </div>


</div><!--.cvContent-->

<div class="reveal large" id="js-modalBillOverview" data-reveal>
  <!-- Content will be loaded here from somwhere else, crazy! -->
  <button class="close-button" data-close aria-label="Close modal" type="button">
    <span aria-hidden="true">&times;</span>
  </button>

  <h4>ProRepublica API Call: <small>Get a Specific Bill</small></h4>
  <p>Use this request type to get details about a particular bill, including actions taken and votes. The attributes house_passage_vote and senate_passage_vote are populated (with the date of passage) only upon successful passage of the bill. Bills before the 113th Congress (prior to 2013) have fewer attribute values than those from the 113th Congress onward, because the more recent bill data comes from the bulk data provided by the Government Publishing Office. Details for the older bills came from scraping Thomas.gov, the former congressional site of the Library of Congress.</p>

</div>

<div class="reveal large" id="js-modalBillArticles" data-reveal>
  <!-- Content will be loaded here from somwhere else, crazy! -->
  <button class="close-button" data-close aria-label="Close modal" type="button">
    <span aria-hidden="true">&times;</span>
  </button>
</div>


<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/js/foundation.min.js"></script>
<script>
  $(document).foundation();
</script>

<script>

  $.ajax({
   url: "https://api.propublica.org/congress/v1/bills/upcoming/house.json",
   type: "GET",
   dataType: 'json',
   headers: {'X-API-Key': 'sHCEuVsfOi06N1Ltq7cIYA2D4J80qhMy7cOa1SWt'}
   //async: false
  })
  .done(function(dataJSON){ // function call when response is received, dataJSON is response from ajax call

    var dataString = JSON.stringify(dataJSON,null,'\t'); // convert json object to string

    var dataUpcomingJSON = dataJSON.results[0].bills; // JSON object with only array of votes
    var voteRowHTML; // string with HTML for display

    for (var i = 0; i < dataUpcomingJSON.length; i++) { // loop through votes

      // create HTML for current vote
      voteRowHTML =
        '<div class="cvContent_panel"> \n' +
          '<h6 class="light-text float-right">' + dataUpcomingJSON[i].bill_number + '</h6> \n' +
          '<h6 class="light-text">' + dataUpcomingJSON[i].chamber + '</h6> \n' +
          '<h4>' + dataUpcomingJSON[i].description + '</h4> \n' +

          '<div class="button-group secondary expanded small"> \n' +
            '<button class="button js-billOverview" data-bill-slug="'+ dataUpcomingJSON[i].bill_slug + '"' +
                  ' data-bill-desc="' + dataUpcomingJSON[i].description + '">Bill Overview</button> \n' +
            '<button class="button js-billArticles" data-bill-slug="'+ dataUpcomingJSON[i].bill_slug + '"' +
                  ' data-bill-desc="' + dataUpcomingJSON[i].description + '"' +
                  ' data-bill-number="' + dataUpcomingJSON[i].bill_number + '">News Articles</button> \n' +
          '</div> \n' +
        '</div> \n'


        $(".js-homeUpcoming").append(voteRowHTML); // append html to results div
    }

    enableArticleButtons();
    //$("body").append('<pre>' + dataString + '</pre>'); // print the response to pre tag (maintaining spaces and line breaks)

  });

</script>

<script>
  function enableArticleButtons() {

  $('.js-billArticles').on('click', function() {

    var sources = "the-new-york-times," +
                  "the-washington-post," +
                  "usa-today," +
                  "nbc-news," +
                  "reuters," +
                  "msnbc," +
                  "independant," +
                  "cnn," +
                  "cbs-news," +
                  "abc-news," +
                  "google-news," +
                  "bbc-news"

    var billNumber = $(this).data("bill-number");
    var billSlug = $(this).data("bill-slug");
    var billDesc = $(this).data("bill-desc");

    var query = encodeURIComponent('"' + billSlug + '" OR "' + billNumber + '" ');

    //console.log("sources: " + sources);
    //console.log("query: " + query);

    var apiUrl = "https://newsapi.org/v2/everything?q=" + query + "&from=2017-01-01&sortBy=relevancy&sources=" + sources;

    console.log("news api: " + apiUrl);

    $.ajax({
     url: apiUrl,
     type: "GET",
     dataType: 'json',
     headers: {'X-Api-Key': '6ae0570e133347c9af205810da9ef7e1'}
    })
    .done(function(dataJSON){ // function call when response is received, dataJSON is response from ajax call
      dataString = JSON.stringify(dataJSON,null,'\t'); // convert json object to string
      $('#js-modalBillArticles').append('<h4>Search by bill number</h4><p>API Call: ' + apiUrl + '</p>' + '<pre>' + dataString + '</pre>').foundation('open');


      query = encodeURIComponent(billDesc);
      url = "https://newsapi.org/v2/everything?q=" + query + "&from=2017-01-01&sortBy=relevancy&sources=" + sources;

      console.log("news api: " + apiUrl);

      $.ajax({
       url: apiUrl,
       type: "GET",
       dataType: 'json',
       headers: {'X-Api-Key': '6ae0570e133347c9af205810da9ef7e1'}
      })
      .done(function(dataJSON){ // function call when response is received, dataJSON is response from ajax call
        dataString = JSON.stringify(dataJSON,null,'\t');
        $("#js-modalBillArticles").append('<hr><h4>Search by bill desc</h4><p>API Call: ' + apiUrl + '</p>' + '<pre>' + dataString + '</pre>');

      });

    });



  })

  $('.js-billOverview').on('click', function() {

    var billDesc = $(this).data("bill-desc");
    var billSlug = $(this).data("bill-slug");
    var apiUrl = 'https://api.propublica.org/congress/v1/115/bills/' + billSlug + '.json'

    console.log("prorepublica api: " + apiUrl);

    $.ajax({
     url: apiUrl,
     type: "GET",
     dataType: 'json',
     headers: {'X-API-Key': 'sHCEuVsfOi06N1Ltq7cIYA2D4J80qhMy7cOa1SWt'}
     //async: false
    })
    .done(function(dataJSON){ // function call when response is received, dataJSON is response from ajax call

      var dataString = JSON.stringify(dataJSON,null,'\t'); // convert json object to string
      $('#js-modalBillOverview').append('<hr><h5>' + billDesc + '</h5><h6>API Call: ' + apiUrl + '</h6>' + '<pre>' + dataString + '</pre>').foundation('open');

    });

      /*      $.ajax({
      query = encodeURIComponent(billDesc);
      url = "https://newsapi.org/v2/everything?q=" + query + "&from=2017-01-01&sortBy=relevancy&sources=" + sources;

      console.log(url);

       url: url,
       type: "GET",
       dataType: 'json',
       headers: {'X-Api-Key': '6ae0570e133347c9af205810da9ef7e1'}
      })
      .done(function(dataJSON){ // function call when response is received, dataJSON is response from ajax call
        dataString = JSON.stringify(dataJSON,null,'\t');
        $("#js-modalBillArticles").append('<hr><h4>Search by bill desc</h4><p>API Call: ' + url + '</p>' + '<pre>' + dataString + '</pre>');

      });*/

  })

}
</script>

</body>
</html>
